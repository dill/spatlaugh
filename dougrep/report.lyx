#LyX 2.2 created this file. For more info see http://www.lyx.org/
\lyxformat 508
\begin_document
\begin_header
\save_transient_properties true
\origin unavailable
\textclass article
\begin_preamble
\usepackage[style=authoryear,natbib=true,backend=biber,firstinits=true,uniquename=init]{biblatex} 
\addbibresource{this.bib}
\end_preamble
\use_default_options true
\begin_modules
knitr
\end_modules
\maintain_unincluded_children false
\begin_local_layout
Provides natbib 1
\end_local_layout
\language british
\language_package default
\inputencoding auto
\fontencoding global
\font_roman "ae" "default"
\font_sans "default" "default"
\font_typewriter "default" "default"
\font_math "auto" "auto"
\font_default_family default
\use_non_tex_fonts false
\font_sc false
\font_osf false
\font_sf_scale 100 100
\font_tt_scale 100 100
\graphics default
\default_output_format default
\output_sync 0
\bibtex_command biber
\index_command default
\paperfontsize default
\spacing single
\use_hyperref false
\papersize default
\use_geometry true
\use_package amsmath 1
\use_package amssymb 1
\use_package cancel 1
\use_package esint 1
\use_package mathdots 1
\use_package mathtools 1
\use_package mhchem 1
\use_package stackrel 1
\use_package stmaryrd 1
\use_package undertilde 1
\cite_engine natbib
\cite_engine_type authoryear
\biblio_style 
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date false
\justification true
\use_refstyle 1
\branch orig-not-used
\selected 0
\filename_suffix 0
\color #faf0e6
\end_branch
\index Index
\shortcut idx
\color #008000
\end_index
\leftmargin 2.4cm
\topmargin 3.5cm
\rightmargin 2.4cm
\bottommargin 3.5cm
\secnumdepth 3
\tocdepth 3
\paragraph_separation indent
\paragraph_indentation default
\quotes_language english
\papercolumns 1
\papersides 1
\paperpagestyle default
\tracking_changes false
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout Title
When can abundance surveys be analysed with 
\begin_inset Quotes eld
\end_inset

design-based
\begin_inset Quotes erd
\end_inset

 methods?
\end_layout

\begin_layout Author
David L.
 Miller
\begin_inset script superscript

\begin_layout Plain Layout
123
\end_layout

\end_inset

 and Mark V.
 Bravington
\begin_inset script superscript

\begin_layout Plain Layout
4
\end_layout

\end_inset


\end_layout

\begin_layout Address
\begin_inset script superscript

\begin_layout Plain Layout
1
\end_layout

\end_inset

Integrated Statistics, Woods Hole, MA
\begin_inset Newline newline
\end_inset


\begin_inset script superscript

\begin_layout Plain Layout
2
\end_layout

\end_inset

Centre for Research into Ecological and Environmental Modelling & School
 of Mathematics and Statistics, University of St
\begin_inset space ~
\end_inset

Andrews, St
\begin_inset space ~
\end_inset

Andrews, Scotland
\begin_inset Newline newline
\end_inset


\begin_inset script superscript

\begin_layout Plain Layout
3
\end_layout

\end_inset

Woods Hole Oceanographic Institution, Woods Hole, MA
\begin_inset Newline newline
\end_inset


\begin_inset script superscript

\begin_layout Plain Layout
4
\end_layout

\end_inset

Commonwealth Scientific and Industrial Research Organization, Hobart, TAS
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<preamble, include=FALSE>>=
\end_layout

\begin_layout Plain Layout

opts_knit$set(cache=TRUE)
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Section
Introduction
\begin_inset CommandInset label
LatexCommand label
name "sec:Introduction"

\end_inset


\end_layout

\begin_layout Standard
The IWC Scientific Committee (SC) often has to consider abundance estimates
 derived from line transect surveys which have been analysed using 
\begin_inset Quotes eld
\end_inset

design-based estimators
\begin_inset Quotes erd
\end_inset

, but where for various reasons it is not clear whether the resulting estimates
 of abundance and uncertainty are trustworthy for, say, RMP purposes.
 The SC has therefore in recent years (up to 2016) considered revising its
 formal Guidelines
\begin_inset Foot
status collapsed

\begin_layout Plain Layout
The Requirements and Guidelines for Conducting Surveys and Analysing Data
 within the Revised Management Management Scheme: IWC (2012).
 “Requirements and Guidelines for Conducting Surveys and Analysing Data
 within the Revised Management Scheme”.
 J.
 Cetacean Res.
 Manage.
 (Suppl.) 13, pp.
 509–517.
\end_layout

\end_inset

 to take advantage of methodological developments, in particular the increased
 flexibility offered by 
\begin_inset Quotes eld
\end_inset

model-based
\begin_inset Quotes erd
\end_inset

 abundance estimates, constructed statistically around smooth estimates
 of animal density across space.
 As background for that revision, document IWC/65b/RMP11 (Hedley & Bravington
 2014) describes the randomization assumptions 
\emph on
required
\emph default
 by design-based 
\emph on
principles
\emph default
; it also introduces some of the practical issues around model-based estimates,
 which are more flexible but also more complicated to implement.
 In section
\begin_inset space ~
\end_inset

11 of that document, the authors note that it may sometimes be possible
 to derive acceptable estimates of abundance and uncertainty using a design-base
d calculation— which in 
\emph on
this
\emph default
 document we call an HT (
\begin_inset Quotes eld
\end_inset

Horvitz-Thompson-like
\begin_inset Quotes erd
\end_inset

) estimate— even when the underlying design-based assumptions are not strictly
 met, provided that (among other things) realised coverage is sufficiently
 even.
 This has been common practice at IWC and elsewhere, but generally on an
 
\emph on
ad hoc
\emph default
 basis with no clear criteria for 
\begin_inset Quotes eld
\end_inset

how bad is too bad?
\begin_inset Quotes erd
\end_inset

.
 For such cases, IWC/65b/RMP11 recommends instead that HT acceptability
 needs to be verified on a case-by-case basis, using diagnostics derived
 from model-based analysis.
\end_layout

\begin_layout Standard
This document follows up on that suggestion.
 We briefly review the main differences between HT and model-based estimates
 (section
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "sec:Methods"

\end_inset

), explain where problems can occur with the former (
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:Motivation"

\end_inset

), and through simulation demonstrate those problems and how they might
 be checked for using model-based criteria (sections
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "sec:Simulation"

\end_inset

, 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:Results"

\end_inset

).
 The idea is to consider a range of scenarios about underlying density gradients
, then fit different spatial models (including a 
\begin_inset Quotes eld
\end_inset

null model
\begin_inset Quotes erd
\end_inset

 that is equivalent to an HT estimate) to data simulated from the actual
 survey tracks and each density scenario, then check the consistency of
 point estimates and variance estimates across the different models.
 Software implementing these criteria/checks is available as an accompanying
 R package.
\end_layout

\begin_layout Standard
In order to keep things tractable, we have made certain assumptions, beyond
 the usual requirements for distance sampling 
\begin_inset CommandInset citation
LatexCommand citep
before "see e.g.,"
key "Buckland:2001vm,Buckland:2004ts,buckland2015distance"

\end_inset

):
\end_layout

\begin_layout Itemize
Transect lines are the ones actually visited (
\begin_inset Quotes eld
\end_inset

realised effort
\begin_inset Quotes erd
\end_inset

), not whatever may have been planned in the original design.
\end_layout

\begin_layout Itemize
We assume there is 
\emph on
some
\emph default
 environmental covariate related to sighting probability that has been measured
 along (within) transect lines, not just when sighting is made (e.g., Beaufort
 sea state recorded as 
\begin_inset Quotes eld
\end_inset

good
\begin_inset Quotes erd
\end_inset

 or 
\begin_inset Quotes eld
\end_inset

worse
\begin_inset Quotes erd
\end_inset

 categories).
 We refer to this covariate simply as 
\begin_inset Quotes eld
\end_inset

weather
\begin_inset Quotes erd
\end_inset

.
 For evaluating a survey, it should not matter too much exactly how the
 weather covariate is defined.
 Without a weather covariate, though, we do not consider it possible to
 adequately evaluate HT acceptability 
\shape italic
post hoc
\shape default
 (see section
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "sec:Motivation"

\end_inset

).
\end_layout

\begin_layout Itemize
We assume that detectability, broadly speaking has already been estimated
 in a preliminary step.
 So 
\begin_inset Formula $g\left(0\right)$
\end_inset

 and availability etc have already been estimated .
 What is required for evaluation, is the integrated detection probability
 out to the truncation distance; the details of functional form do not matter.
 
\end_layout

\begin_layout Itemize
We have ignored school/group size; if a survey is not going to lead to reliable
 HT analysis even if all groups are size 1 with equal detectability, then
 variations in group size (and detectability) are hardly going to improve
 matters.
 Group size error is an even harder issue.
 See section
\begin_inset space ~
\end_inset

9 of IWC/65b/RMP11 for some discussion.
\end_layout

\begin_layout Standard
With these assumptions in mind, we now go on to describe the HT and spatial
 approaches to estimating abundance.
\end_layout

\begin_layout Section
Methods
\begin_inset CommandInset label
LatexCommand label
name "sec:Methods"

\end_inset


\end_layout

\begin_layout Standard
We do not spend time here describing fitting the detection function to the
 distance data and refer readers to 
\begin_inset CommandInset citation
LatexCommand citet
key "Buckland:2001vm,Buckland:2004jq,buckland2015distance"

\end_inset

 for information on model formulation and selection.
 Assuming a fitted detection function (which we will denote 
\begin_inset Formula $\hat{g}$
\end_inset

— a function of distance (
\begin_inset Formula $y$
\end_inset

), observed detection-related covariates such as weather (
\begin_inset Formula $\mathbf{z}$
\end_inset

), and estimated parameters (
\begin_inset Formula $\boldsymbol{\theta}$
\end_inset

)), we can estimate the average (over distance) probability of detection
 for an observation (indexed by 
\begin_inset Formula $i$
\end_inset

, conditional on observed covariate values), 
\begin_inset Formula $\hat{p}_{i}$
\end_inset

, by integrating 
\begin_inset Formula $\hat{g}\left(y;\mathbf{z_{i}},\boldsymbol{\theta}\right)$
\end_inset

 across perpendicular distances 
\begin_inset Formula $y$
\end_inset

 out to the truncation distance.
\end_layout

\begin_layout Subsection
Horvitz-Thompson-like estimators
\begin_inset CommandInset label
LatexCommand label
name "subsec:HT"

\end_inset


\end_layout

\begin_layout Standard
We first describe the 
\begin_inset Quotes eld
\end_inset

Horvitz-Thompson-like
\begin_inset Quotes erd
\end_inset

 estimator 
\begin_inset CommandInset citation
LatexCommand citep
before "e.g.,"
key "Borchers:2004wr"

\end_inset

.
 In its simplest version, the HT estimator is
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\hat{N}_{HT}=\frac{A}{a}\sum_{i=1}^{n}\frac{s_{i}}{\hat{p}_{i}},\label{eq:HT}
\end{equation}

\end_inset

where 
\begin_inset Formula $n$
\end_inset

 is the number of observations (number of groups if animals occur in clusters),
 indexed by 
\begin_inset Formula $i$
\end_inset

, 
\begin_inset Formula $s_{i}$
\end_inset

 is the size of the 
\begin_inset Formula $i^{\text{th}}$
\end_inset

 group (or always 1 if animals are solitary) and 
\begin_inset Formula $\hat{p}_{i}$
\end_inset

 is the detectability estimated for the 
\begin_inset Formula $i^{\text{th}}$
\end_inset

 group, which will be a function of the covariates for that observation.
 The total area surveyed (
\shape italic
covered area
\shape default
) is 
\begin_inset Formula $a$
\end_inset

, which is the sum of the product of the line lengths and their corresponding
 strip widths (if the strips were all the same width then 
\begin_inset Formula $a=2wL$
\end_inset

, where 
\begin_inset Formula $w$
\end_inset

 is the strip half-width as in Buckland et al 2001, and 
\begin_inset Formula $L$
\end_inset

 is the sum of all the lines' lengths).
 Finally, 
\begin_inset Formula $A$
\end_inset

 is the area that we wish to estimate abundance for (sometimes referred
 to as the 
\shape italic
study area
\shape default
).
 Intuitively, we take the group sizes, correct them for detectability and
 sum to get an estimate of abundance in the covered area, which we then
 rescale to the study region.
 The HT estimator can only estimate animal density at a constant level within
 the area 
\begin_inset Formula $A$
\end_inset

; the rescaling assumes that the density in the observed area is representative
 of the larger area.
 The unbiasedness of equation 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:HT"

\end_inset

 relies on the inclusion probability of the observations being known, we
 estimate these (via estimating detectability and implicitly assuming equal
 inclusion probability; see IWC/65b/RMP11 section
\begin_inset space ~
\end_inset

1) so equation 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:HT"

\end_inset

 is only unbiased when these assumptions hold.
 These assumptions may be approximately valid in some situations, but it
 is hard to check directly.
\end_layout

\begin_layout Standard
We can perform pre or post hoc stratification, slicing-up the study area
 into smaller regions (
\shape italic
strata
\shape default
)
\shape italic
 
\shape default
and estimating abundance for each of these.
 These may be geographically defined (
\begin_inset Quotes eld
\end_inset

near vs.
 far from shore
\begin_inset Quotes erd
\end_inset

, 
\begin_inset Quotes eld
\end_inset

east/west of some feature
\begin_inset Quotes erd
\end_inset

, etc), based on conditions at sea (
\begin_inset Quotes eld
\end_inset

dense vs.
 non-dense ice
\begin_inset Quotes erd
\end_inset

) or based on oceanographic features (
\begin_inset Quotes eld
\end_inset

deep or shallow water
\begin_inset Quotes erd
\end_inset

).
 Mathematically, this consists of changing the limits of the sum (summing
 over the animals which occur in a given stratum), then changing 
\begin_inset Formula $a$
\end_inset

 and 
\begin_inset Formula $A$
\end_inset

 accordingly to reflect the effort in the given stratum and the area of
 that stratum, respectively; abundance estimates can then be summed to obtain
 total abundance or given per-stratum form.
 In some sense these estimates reflect a crude, 
\begin_inset Quotes eld
\end_inset

blocky
\begin_inset Quotes erd
\end_inset

 spatial model, which try to address the deeper drivers of distribution
 in a given species.
 Stratification can be performed using animal/group-specific covariates
 (e.g., abundance of males/females, juveniles/adults etc), though we do not
 address this here.
 The assumptions and shortcomings mentioned in the previous paragraph still
 apply, but on a smaller scale, so may be more defensible.
 
\end_layout

\begin_layout Standard
Variance is estimated for 
\begin_inset Formula $\hat{N}_{HT}$
\end_inset

 by noting that there are (at least) two sources of stochasticity in the
 equation: 
\shape italic
(i) 
\shape default
from the variance in the model for 
\begin_inset Formula $\hat{p}_{i}$
\end_inset

 (i.e., the detection function) and 
\shape italic
(ii)
\shape default
 by noting that the observed number of observations, 
\begin_inset Formula $n$
\end_inset

, is random.
 If animals are observed in groups, then there is also variation from the
 group size to consider.
 The variance component from 
\begin_inset Formula $\hat{p}_{i}$
\end_inset

 can be calculated by using the variance from the detection function estimation
 procedure and using a sandwich estimator to express that parameter variance
 on the scale of 
\begin_inset Formula $\hat{p}_{i}$
\end_inset

 
\begin_inset CommandInset citation
LatexCommand citep
after "Appendix C"
key "Borchers:2002vs"

\end_inset

.
 Variance in 
\begin_inset Formula $n$
\end_inset

 is usually calculated as variance in 
\begin_inset Formula $n/L$
\end_inset

: the 
\shape italic
encounter rate
\shape default
 variance.
 There are a number of formulations for this estimator, depending on the
 possible design used.
 
\begin_inset CommandInset citation
LatexCommand citet
key "Fewster:2009ku"

\end_inset

 proposes a series of estimators and evaluates them.
 Here we use the 
\begin_inset CommandInset citation
LatexCommand citet
key "Fewster:2009ku"

\end_inset

 R2 estimator (though we use an encounter rate estimator of 
\begin_inset Formula $\hat{N}/L$
\end_inset

 as in 
\begin_inset CommandInset citation
LatexCommand citealp
key "Innes:2002ka"

\end_inset

).
 Note though that this estimator only considers variance between the sample
 units: the transects, so if transects are long and there is significant
 variation in density along the transect, we may obtain variance estimates
 that are far too small.
 If animals occur in groups, we calculate the variance in group size empirically.
\end_layout

\begin_layout Subsection
Density surface models
\begin_inset CommandInset label
LatexCommand label
name "subsec:DSM"

\end_inset


\end_layout

\begin_layout Standard
We now describe one spatially explicit approach to modelling distance sampling
 line transect survey data, which we refer to as 
\shape italic
density surface modelling
\shape default
 
\begin_inset CommandInset citation
LatexCommand citep
before "DSM;"
key "Hedley:2004et,Miller:2013fq"

\end_inset

.
 As with HT estimators, they assume that the detection function has already
 been adequately fitted to the distance data and estimates of probability
 of detection are available for the spatial model to use.
 The spatial part of the model uses the generalized additive modelling framework
 
\begin_inset CommandInset citation
LatexCommand citep
key "hastie1990generalized,Ruppert:2003uc,Wood:2006vg"

\end_inset

 to build smooth, spatially explicit terms describing the distribution of
 the species and their response to other biological/physical variables (though
 here we only consider models that include smooths of location).
 Rather than dealing with whole transects (which are generally long and
 in which animal density and environmental covariate values can change appreciab
ly), we cut the transects into smaller pieces, which we call 
\shape italic
segments
\shape default
.
 The mean response of the model can be written as:
\begin_inset Formula 
\[
\mathbb{E}(n_{j})=A_{j}\hat{p}_{j}\exp\left[\beta_{0}+\sum_{k}s_{k}(z_{kj})\right],
\]

\end_inset

where 
\begin_inset Formula $j$
\end_inset

 indexes the segments, which have area 
\begin_inset Formula $A_{j}$
\end_inset

 and all observations in that segment have a probability of detection of
 
\begin_inset Formula $\hat{p}_{j}$
\end_inset

.
 The response, 
\begin_inset Formula $n_{j}$
\end_inset

 (count per segment), is distributed according to some count distribution
 (usually Tweedie or negative binomial) for which 
\begin_inset Formula $\exp$
\end_inset

 is the inverse link function
\begin_inset Foot
status collapsed

\begin_layout Plain Layout
Though any exponential (and beyond) family response can be used in the GAM
 framework with any appropriate link function, we just talk about count
 distributions and log link functions for clarity of notation.
\end_layout

\end_inset

.
 The model intercept is 
\begin_inset Formula $\beta_{0}$
\end_inset

.
 The 
\begin_inset Formula $s_{k}$
\end_inset

 are usually splines 
\begin_inset CommandInset citation
LatexCommand citep
key "deBoor:1978wq"

\end_inset

: smooth functions of one or more covariates (denoted 
\begin_inset Formula $z_{jk}$
\end_inset

), though could be more exotic things like random effects, tensor products,
 smooth-factor interactions and so forth 
\begin_inset CommandInset citation
LatexCommand citep
key "Wood:2006vg,Wood:2016cw"

\end_inset

.
 The exact form of each 
\begin_inset Formula $s_{k}$
\end_inset

 depends on the nature of the effect we wish to model, for smooths of location
 there are quite a few options, some of which are enumerated and described
 below (IWC/65b/RMP11 also discusses this in section
\begin_inset space ~
\end_inset

7.2).
\end_layout

\begin_layout Standard
A typical DSM may take a form such as:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\mathbb{E}(n_{j})=A_{j}\hat{p}_{j}\exp\left[\beta_{0}+s_{x,y}(x_{j},y_{j})+s_{\text{Depth}}(\text{Depth}_{j})\right],
\]

\end_inset

that is: the expected count in segment 
\begin_inset Formula $j$
\end_inset

 is a function of its location and the water depth at that location, this
 is then exponentiated onto the response scale, and multiplied by the area
 of the segment and probability of detection in that segment.
\end_layout

\begin_layout Standard
Note that here the probability of detection has a subscript 
\begin_inset Formula $j$
\end_inset

 not 
\begin_inset Formula $i$
\end_inset

 as in the HT estimator.
 This is because in this formulation of the DSM we only consider detectability
 as varying at the scale of the segments, not the observed individuals/groups.
 This means that covariates such as weather, observer shift/team or ship
 can be included in the detection function, but sex of the animal or observer
 ID (if there were multiple observers on deck at once) cannot be
\begin_inset Foot
status collapsed

\begin_layout Plain Layout
These covariates can be included in a more general formulation of DSMs,
 though we don't consider them here for clarity of presentation.
 See 
\begin_inset CommandInset citation
LatexCommand citet
key "Miller:2013fq"

\end_inset

 for further details.
\end_layout

\end_inset

.
\end_layout

\begin_layout Section
Why do spatial modelling?
\begin_inset CommandInset label
LatexCommand label
name "sec:Motivation"

\end_inset


\end_layout

\begin_layout Standard
A criticism of the DSM approach is that it is more complex, as we explicitly
 model the spatial and possibly environmental covariate effects.
 More mode checking is required and there is a wide literature of often
 conflicting advice on how to construct models.
 However, explicit modelling is the only way to deal with the heterogeneity
 in spatial distribution of the study species.
 In this section we give some some arguments about why HT estimation may
 not be a good idea from a theoretical perspective.
\end_layout

\begin_layout Subsection
Appeals to pooling robustness
\end_layout

\begin_layout Standard
An appeal to 
\begin_inset Quotes eld
\end_inset

pooling robustness
\begin_inset Quotes erd
\end_inset

 
\begin_inset CommandInset citation
LatexCommand citep
after "Section 11.12"
key "Buckland:2004ts"

\end_inset

 does not get around heterogeneity in the spatial distribution of the population.
 Before explaining why, we first define and explain pooling robustness in
 a distance sampling context.

\shape italic
 
\shape default
From 
\begin_inset CommandInset citation
LatexCommand citet
key "Burnham:1980wz"

\end_inset

:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
n\hat{f}(0)=\sum_{r=1}^{R}n_{r}\hat{f}_{r}(0),
\]

\end_inset

where there are 
\begin_inset Formula $R$
\end_inset

 strata chosen to minimise heterogeneity, 
\begin_inset Formula $n$
\end_inset

 is the total number of observations, 
\begin_inset Formula $n_{r}$
\end_inset

 is the number of observations in stratum 
\begin_inset Formula $r$
\end_inset

 and 
\begin_inset Formula $\hat{f}(0)$
\end_inset

 and 
\begin_inset Formula $\hat{f}_{r}(0)$
\end_inset

 are the probability density functions of the observed distances, evaluated
 at zero distance, for the whole sample and by stratum, respectively.
 Equivalently we can write:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\frac{n}{\hat{p}}=\sum_{r=1}^{R}\frac{n_{r}}{\hat{p}_{r}}.
\]

\end_inset


\end_layout

\begin_layout Standard
Intuitively, we say that if pooling robustness holds, the estimates from
 a stratified analysis would be the same as those for an unstratified analysis.
 
\begin_inset CommandInset citation
LatexCommand citet
after "Section 11.12"
key "Buckland:2004ts"

\end_inset

 state: 
\begin_inset Quotes eld
\end_inset

if only an overall abundance estimate is required, standard methods without
 covariates [in the detection function] are satisfactory under rather mild
 conditions, provided heterogeneity in detectability is not too extreme.
\begin_inset Quotes erd
\end_inset

 This is a statement about HT estimation in the presence of (mild) detection
 heterogeneity and does not address spatial variation in density within
 strata.
 If we knew the optimal 
\begin_inset Formula $R$
\end_inset

 strata to chop our survey into, according to the density gradient we might
 be onto something, but this is impossible in practice.
\end_layout

\begin_layout Standard
So far we have only considered the case where detectability is certain on
 the line (
\begin_inset Formula $g(0)=1$
\end_inset

).
 If we start to consider issues around uncertain detectability on the line
 
\begin_inset CommandInset citation
LatexCommand citep
key "Borchers:1998eq,Borchers:1998ic,Borchers:2005do,Burt:2014gu"

\end_inset

 this situation only gets more complicated.
 
\begin_inset CommandInset citation
LatexCommand citet
key "Buckland:2004ts"

\end_inset

 note that if the detection function includes covariates 
\begin_inset Quotes eld
\end_inset

then the model robustness criterion fails, and we must model the heterogeneity
 to avoid bias
\begin_inset Quotes erd
\end_inset

.
 So, if we do expect that the probability of detection at zero distance
 is influenced by covariates (which it almost surely will be in a cetacean
 survey), pooling robustness does not apply.
\end_layout

\begin_layout Subsection
Weather covariates
\begin_inset CommandInset label
LatexCommand label
name "subsec:Weather-covariates"

\end_inset


\end_layout

\begin_layout Standard
Following on from pooling robustness, we now think more about recording
 a sighting conditions covariate, such as weather.
 It is not enough to 
\begin_inset Quotes eld
\end_inset

see
\begin_inset Quotes erd
\end_inset

 that tracklines physically cover the entire study area in a seemingly even
 way; if most of the survey effort in the West are in good sighting conditions
 whereas most in the East are in poor conditions, then the actual effort
 can be quite imbalanced.
 (The tracklines on the West have higher sighting probabilities, so they
 are in effect 
\begin_inset Quotes eld
\end_inset

wider
\begin_inset Quotes erd
\end_inset

 and cover a higher proportion of nearby areas, but the width difference
 is not visible on the scale of a plot.) The average probability of detection
 of a whale (across all whales in the region) is not the same as the average
 detection probability averaged along the trackline.
\end_layout

\begin_layout Standard
If density does vary within strata the effect of detectability and distribution
 are confounded, unless data on observation conditions (e.g., a weather covariate)
 and spatial distribution (e.g., location of transects) is recorded and modelled.
 A spatial model that includes data on the location of the observations
 and the sighting conditions will be able to tease apart these effects and
 attribute appropriate uncertainty.
 For example, say we saw many animals in the West of the study area and
 fewer in the East.
 Let us also say that there were good sighting conditions in the West and
 poor sighting conditions in the East.
 If we ignore the weather covariate, we have know way of knowing if there
 truly were many animals in the West or whether it was just the effect of
 having good sighting conditions.
 
\end_layout

\begin_layout Standard
This is the reason for our stipulation that HT-acceptability (i.e., robustness
 to animal density variations) can only be assessed when a weather covariate
 is available.
 For a full analysis of data, some care is usually given to the choice of
 covariate (e.g., number of levels, if the covariate is a factor; use of several
 covariates together), but for broad assessment of uniformity, we suspect
 that the choice does not matter too much.
 For example, splitting Beaufort into two levels such that the 
\begin_inset Quotes eld
\end_inset

good
\begin_inset Quotes erd
\end_inset

 level contains 1/3—2/3 of total sightings, and the 
\begin_inset Quotes eld
\end_inset

poor
\begin_inset Quotes erd
\end_inset

 level contains the rest, should be sufficient.
 Using a simple classification of that type makes it easy to estimate a
 separate detection probability by 
\begin_inset Quotes eld
\end_inset

weather level
\begin_inset Quotes erd
\end_inset

, simply by splitting the sightings according to weather before fitting
 a separate detection function to each.
\end_layout

\begin_layout Subsection
Designs with unknown coverage probability
\end_layout

\begin_layout Standard
Implicit in the HT formula (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:HT"

\end_inset

) is the assumption that all locations in the study area are (at least approxima
tely) equally likely to be sampled (e.g., IWC/65b/RMP11
\begin_inset space ~
\end_inset

section 1; 
\begin_inset CommandInset citation
LatexCommand citealp
key "Borchers:2004wr"

\end_inset

).
 With a truly randomised (or systematic) design, this is certainly the case,
 but it is often the case that designs are 
\begin_inset Quotes eld
\end_inset

constructed
\begin_inset Quotes erd
\end_inset

 rather than realised from a randomisation process (such as that provided
 in Distance for Windows 
\begin_inset CommandInset citation
LatexCommand citep
key "Thomas:2010cf"

\end_inset

).
 This can be for a variety of logistical reasons, but the lack of randomisation
 invalidates the design-based justification for HT estimation of abundance.
\end_layout

\begin_layout Standard
Given the above, there is a temptation then to fit a 
\begin_inset Quotes eld
\end_inset

dumb
\begin_inset Quotes erd
\end_inset

 spatial model and hope for the best.
 Properly configuring a spatial model is a time-consuming process requiring
 some 
\begin_inset Quotes eld
\end_inset

expert
\begin_inset Quotes erd
\end_inset

 judgement.
 As well as formulating, fitting and selecting between models, the investigator
 also needs to select an appropriate prediction grid, ensuring that unreasonable
 extrapolations are not made.
 There is no 
\begin_inset Quotes eld
\end_inset

quick fix
\begin_inset Quotes erd
\end_inset

 to obtain a good spatial model, care must be taken in the construction
 and checking of the model if reasonable inferences are to be drawn.
\end_layout

\begin_layout Section
Simulation setup
\begin_inset CommandInset label
LatexCommand label
name "sec:Simulation"

\end_inset


\end_layout

\begin_layout Standard
With the above in mind, we set about constructing some simple simulations
 of plausible survey data.
 We attempted to keep the underlying densities as simple as possible and
 the realised designs as fairly realistic.
\end_layout

\begin_layout Subsection
Density surfaces
\begin_inset CommandInset label
LatexCommand label
name "subsec:Density-surfaces"

\end_inset


\end_layout

\begin_layout Standard
We used a series of simple density surfaces to test for differences between
 the proposed models.
 Although animal distribution is much more complicated than the patterns
 shown below, if models perform poorly for these simple density surfaces
 (where gradients are clearly defined) then it is likely that there will
 be more severe issues when more complex surfaces are used.
 In the simulations presented here the following surfaces were investigated:
\end_layout

\begin_layout Itemize
“f”: flat density, uniform distribution across the region.
 
\end_layout

\begin_layout Itemize
“lr”: left to right gradient, high on the left, decreasing as we go right.
 
\end_layout

\begin_layout Itemize
“rl”: right to left gradient, high on the right, decreasing as we go left.
 
\end_layout

\begin_layout Itemize
\begin_inset Quotes eld
\end_inset

diag
\begin_inset Quotes erd
\end_inset

: increasing gradient from top right to bottom left
\end_layout

\begin_layout Standard
These are shown in Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:densities"

\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<densities, fig.width=9, fig.height=3, echo=FALSE, message=FALSE, warning=FALSE>>
=
\end_layout

\begin_layout Plain Layout

library(viridis)
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

par(mfrow=c(1,4))
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

# first 3
\end_layout

\begin_layout Plain Layout

n_grid_x <- 300
\end_layout

\begin_layout Plain Layout

n_grid_y <- 100
\end_layout

\begin_layout Plain Layout

density.surface <- expand.grid(x = seq(0, 3, len=n_grid_x),
\end_layout

\begin_layout Plain Layout

                               y = seq(0, 1, len=n_grid_y))
\end_layout

\begin_layout Plain Layout

densities <- list(rep(1, length(density.surface$x)),
\end_layout

\begin_layout Plain Layout

			      rev(density.surface$x),
\end_layout

\begin_layout Plain Layout

				  density.surface$x,
\end_layout

\begin_layout Plain Layout

				  rev(density.surface$x)) 
\end_layout

\begin_layout Plain Layout

names <- list("f", "lr", "rl")    
\end_layout

\begin_layout Plain Layout

for(i in 1:3){   
\end_layout

\begin_layout Plain Layout

  image(matrix(densities[[i]], n_grid_x, n_grid_y),
\end_layout

\begin_layout Plain Layout

        x=seq(0, 3, len=n_grid_x),
\end_layout

\begin_layout Plain Layout

        y= seq(0, 1, len=n_grid_y),
\end_layout

\begin_layout Plain Layout

        col = viridis(1000), main=names[[i]],
\end_layout

\begin_layout Plain Layout

        xlab="x", ylab="y", asp=1)
\end_layout

\begin_layout Plain Layout

  contour(matrix(densities[[i]], n_grid_x, n_grid_y),
\end_layout

\begin_layout Plain Layout

        x=seq(0, 3, len=n_grid_x),
\end_layout

\begin_layout Plain Layout

        y= seq(0, 1, len=n_grid_y),
\end_layout

\begin_layout Plain Layout

        add=TRUE)
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

# one of these densities is not like the other...
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

n_grid_y <- 300
\end_layout

\begin_layout Plain Layout

n_grid_x <- 300
\end_layout

\begin_layout Plain Layout

density.surface <- expand.grid(x = seq(0, 3, len=n_grid_x),
\end_layout

\begin_layout Plain Layout

                               y = seq(0, 3, len=n_grid_y))
\end_layout

\begin_layout Plain Layout

ddens <- (rev(density.surface$x)*rev(density.surface$y))
\end_layout

\begin_layout Plain Layout

image(matrix(ddens, n_grid_x, n_grid_y),
\end_layout

\begin_layout Plain Layout

      x=seq(0, 3, len=n_grid_x),
\end_layout

\begin_layout Plain Layout

      y= seq(0, 3, len=n_grid_y),
\end_layout

\begin_layout Plain Layout

      col = viridis(1000), main="diag",
\end_layout

\begin_layout Plain Layout

      xlab="x", ylab="y", asp=1)
\end_layout

\begin_layout Plain Layout

contour(matrix(ddens, n_grid_x, n_grid_y),
\end_layout

\begin_layout Plain Layout

        x=seq(0, 3, len=n_grid_x),
\end_layout

\begin_layout Plain Layout

        y= seq(0, 3, len=n_grid_y),
\end_layout

\begin_layout Plain Layout

        add=TRUE)
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
The proposed density surfaces.
 From left to right: flat, left-right gradient, right-left gradient, diagonal
 gradient.
 Shorthand names are given as the title for each plot.
\begin_inset CommandInset label
LatexCommand label
name "fig:densities"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Detectability
\begin_inset CommandInset label
LatexCommand label
name "subsec:Detectability"

\end_inset


\end_layout

\begin_layout Standard
Detectability in the survey was set at two fixed detectabilities 
\begin_inset Quotes eld
\end_inset

good
\begin_inset Quotes erd
\end_inset

 and 
\begin_inset Quotes eld
\end_inset

bad
\begin_inset Quotes erd
\end_inset

 by varying the parameters of a hazard-rate detection function.
 We also simulated a two-level weather covariate that changed from left
 to right across the study area, on the left side the weather was 
\begin_inset Quotes eld
\end_inset

good
\begin_inset Quotes erd
\end_inset

 (using the 
\begin_inset Quotes eld
\end_inset

good
\begin_inset Quotes erd
\end_inset

 detection function) and on the right side the weather was 
\begin_inset Quotes eld
\end_inset

bad
\begin_inset Quotes erd
\end_inset

 (using the 
\begin_inset Quotes eld
\end_inset

bad
\begin_inset Quotes erd
\end_inset

 detection function).
 The transition between the detection functions was controlled by a logistic
 function.
 Due to its change along the 
\begin_inset Formula $x$
\end_inset

 axis, the covariate is confounded with the 
\begin_inset Quotes eld
\end_inset

lr
\begin_inset Quotes erd
\end_inset

 and 
\begin_inset Quotes eld
\end_inset

rl
\begin_inset Quotes erd
\end_inset

 density gradients – this is eminently possible in survey data as discussion
 in section
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:Weather-covariates"

\end_inset

.
 Plots of the detection functions used to simulate the data are shown in
 Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:dfs"

\end_inset

 along with their parameters.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<detfct, fig.width=8, fig.height=4, echo=FALSE>>=
\end_layout

\begin_layout Plain Layout

par(mfrow=c(1,2))
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

# parameters
\end_layout

\begin_layout Plain Layout

df_good <- list(key        = "hr",
\end_layout

\begin_layout Plain Layout

                scale      = 0.025,
\end_layout

\begin_layout Plain Layout

                shape      = 3,
\end_layout

\begin_layout Plain Layout

                truncation = 0.05) 
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

df_bad <- list(key        = "hr",
\end_layout

\begin_layout Plain Layout

               scale      = 0.005,
\end_layout

\begin_layout Plain Layout

               shape      = 1,
\end_layout

\begin_layout Plain Layout

               truncation = 0.05)
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

# plotter
\end_layout

\begin_layout Plain Layout

plot_df <- function(df, main=""){
\end_layout

\begin_layout Plain Layout

  distance <- seq(0, 0.06, len=1000)
\end_layout

\begin_layout Plain Layout

  f <- 1 - exp( - (distance/df$scale)^( - df$shape))
\end_layout

\begin_layout Plain Layout

  plot(distance, f, type="l", ylim=c(0,1),
\end_layout

\begin_layout Plain Layout

       xlab="Distance", ylab="Probability of detection", main=main)
\end_layout

\begin_layout Plain Layout

  abline(v=df$truncation, lty=2)
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

# actually make some plots
\end_layout

\begin_layout Plain Layout

plot_df(df_good, "good")
\end_layout

\begin_layout Plain Layout

plot_df(df_bad, "bad")
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Detection functions used in the simulations.
 Dashed line indicates the truncation distance used.
 For the 
\begin_inset Quotes eld
\end_inset

good
\begin_inset Quotes erd
\end_inset

 detection function, the scale parameter was set at 0.025, shape parameter
 at 3.
 For the 
\begin_inset Quotes eld
\end_inset

bad
\begin_inset Quotes erd
\end_inset

 detection function, the scale parameter was set at 0.005, and the shape
 at 1.
 In both cases truncation was at 0.05.
\begin_inset CommandInset label
LatexCommand label
name "fig:dfs"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
For clarity and simplicity we do not consider the case where detectability
 is uncertain at zero distance (
\begin_inset Formula $g(0)\neq1$
\end_inset

) here — we assume that if animals occur directly in front of the observer
 they will be seen.
 We also do not consider any availability issues (that cetaceans are often
 underwater and cannot be seen).
 Finally, we also assume that observations are of single animals (that group
 size is one).
 These are simplifying assumptions, but a modelling strategy that fails
 in this simple situation is unlikely to perform well once any of these
 assumptions are relaxed.
\end_layout

\begin_layout Subsection
Designs
\begin_inset CommandInset label
LatexCommand label
name "subsec:Designs"

\end_inset


\end_layout

\begin_layout Standard
We experimented with four designs.
 A good design with good realised coverage across the whole study area (
\begin_inset Quotes eld
\end_inset

manyzigzags
\begin_inset Quotes erd
\end_inset

; to confirm that what we consider to be a good design gives us the results
 we expect from our metrics).
 Two 
\begin_inset Quotes eld
\end_inset

iffy
\begin_inset Quotes erd
\end_inset

 designs: one with a large gap between each contiguous section of realised
 effort (
\begin_inset Quotes eld
\end_inset

zzl
\begin_inset Quotes erd
\end_inset

) and one with two very different effort distributions for two parts of
 the survey (
\begin_inset Quotes eld
\end_inset

twozigzags
\begin_inset Quotes erd
\end_inset

).
 A bad design where the effort is concentrated along two sides of the area
 (
\begin_inset Quotes eld
\end_inset

corner
\begin_inset Quotes erd
\end_inset

).
 The designs are shown in Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:designs"

\end_inset

.
 In each case the box surrounding the design indicates the area used for
 prediction in the simulations, dashed lines indicate divisions between
 strata used for stratified HT estimates.
\end_layout

\begin_layout Subsubsection*
Design 1: zig-zag with good coverage (
\begin_inset Quotes eld
\end_inset

manyzigzags
\begin_inset Quotes erd
\end_inset

)
\end_layout

\begin_layout Standard
The final design has good coverage over the whole study area and would be
 the ideal realised design.
 Shown in the left panel of Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:designs"

\end_inset

.
\end_layout

\begin_layout Subsubsection*
Design 2: zig-zag with straight line (
\begin_inset Quotes eld
\end_inset

zzl
\begin_inset Quotes erd
\end_inset

)
\end_layout

\begin_layout Standard
This is supposed to mimic the situation in which a zig-zag design went well
 on the left side of the study area, but not realised in the middle of the
 survey (perhaps due to bad weather), then to the left we have a lonely
 transect (perhaps weather picked-up).
 Shown in the second panel of Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:designs"

\end_inset

.
\end_layout

\begin_layout Subsubsection*
Design 3: two different zig-zags (
\begin_inset Quotes eld
\end_inset

twozigzags
\begin_inset Quotes erd
\end_inset

)
\end_layout

\begin_layout Standard
To show how designs often consist of different coverages in different areas
 of the survey region, a design with more effort (many zig-zags) is placed
 next to that with much less coverage (a single zig-zag).
 This is shown in the third panel of 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:designs"

\end_inset

.
\end_layout

\begin_layout Subsubsection*
Design 4: corner (
\begin_inset Quotes eld
\end_inset

corner
\begin_inset Quotes erd
\end_inset

)
\end_layout

\begin_layout Standard
This design concentrates along two sides of the study area, this design
 mimics the commonly used technique where near-coast transects are used
 to extrapolate well beyond the covered area.
 Shown in the right panel of Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:designs"

\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<designs, echo=FALSE, fig.width=11, fig.height=4>>=
\end_layout

\begin_layout Plain Layout

par(mfrow=c(1,4))
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

# function to make the plots
\end_layout

\begin_layout Plain Layout

plot_shape <- function(shape, main, strat=NULL, xlim=c(0,3), ylim=c(0,1)){
\end_layout

\begin_layout Plain Layout

  plot(xlim, ylim, type="n", xlab="x", ylab="y", asp=1, main=main) 
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

  for(i in unique(shape$leg)){ 
\end_layout

\begin_layout Plain Layout

    lines(shape[,c("x","y")][shape$leg==i,]) 
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

  lines(c(xlim[1], xlim[2], xlim[2], xlim[1], xlim[1]),
\end_layout

\begin_layout Plain Layout

        c(ylim[1], ylim[1], ylim[2], ylim[2], ylim[1]))
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

  if(!is.null(strat)){
\end_layout

\begin_layout Plain Layout

    for(i in 1:length(strat)){
\end_layout

\begin_layout Plain Layout

      lines(x=rep(strat[i], 2), y=ylim, lty=2, col="red")
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

# make a zig (or is it a zag?)
\end_layout

\begin_layout Plain Layout

n_segs <- 10
\end_layout

\begin_layout Plain Layout

zz <- data.frame(x = c(seq(0, 0.5, len=n_segs), seq(0.5, 1, len=n_segs)),
\end_layout

\begin_layout Plain Layout

                 y = c(seq(0, 1, len=n_segs), seq(1, 0, len=n_segs)), 
\end_layout

\begin_layout Plain Layout

                 leg = c(rep("1", n_segs), rep("2", n_segs)))
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

# many zigzags
\end_layout

\begin_layout Plain Layout

mzz <- rbind(zz,zz,zz)
\end_layout

\begin_layout Plain Layout

mzz$x <- mzz$x/3 
\end_layout

\begin_layout Plain Layout

ind <- 1:nrow(zz) 
\end_layout

\begin_layout Plain Layout

mzz$x[ind+nrow(zz)] <- mzz$x[ind+nrow(zz)]+1/3 
\end_layout

\begin_layout Plain Layout

mzz$x[ind+2*nrow(zz)] <- mzz$x[ind+2*nrow(zz)]+2/3
\end_layout

\begin_layout Plain Layout

mzz$leg <- as.numeric(mzz$leg) 
\end_layout

\begin_layout Plain Layout

mzz$leg[ind+nrow(zz)] <- mzz$leg[ind+nrow(zz)]+2 
\end_layout

\begin_layout Plain Layout

mzz$leg[ind+2*nrow(zz)] <- mzz$leg[ind+2*nrow(zz)]+4 
\end_layout

\begin_layout Plain Layout

mzz$leg <- as.character(mzz$leg)
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

mzz2 <- mzz
\end_layout

\begin_layout Plain Layout

mzz2$x <- mzz$x*3
\end_layout

\begin_layout Plain Layout

strat_mzz <- c(1,2)
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

## two different sets of zigzags
\end_layout

\begin_layout Plain Layout

R <- matrix(c(cos(pi/2), sin(pi/2), -sin(pi/2), cos(pi/2)),2,2) 
\end_layout

\begin_layout Plain Layout

# many zigzags
\end_layout

\begin_layout Plain Layout

# stretch out over 0,3
\end_layout

\begin_layout Plain Layout

mzz3 <- mzz
\end_layout

\begin_layout Plain Layout

mzz3$x <- mzz$x*3
\end_layout

\begin_layout Plain Layout

mzz3$y <- mzz3$y + 1.5
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

# add bottom zig(zag)
\end_layout

\begin_layout Plain Layout

zzll <- zz
\end_layout

\begin_layout Plain Layout

zzll$x <- zzll$x*3
\end_layout

\begin_layout Plain Layout

zzll$leg <- c(rep("7", n_segs),
\end_layout

\begin_layout Plain Layout

              rep("8", n_segs))
\end_layout

\begin_layout Plain Layout

tb <- rbind.data.frame(mzz3, zzll)
\end_layout

\begin_layout Plain Layout

tb[,c("x","y")] <- t(R %*% t(tb[,c("x","y")]))
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

# zig zag then line
\end_layout

\begin_layout Plain Layout

zzl <- rbind.data.frame(mzz, 
\end_layout

\begin_layout Plain Layout

                        data.frame(x = rep(2.8, 10), 
\end_layout

\begin_layout Plain Layout

                                   y = seq(0, 1, len=10), 
\end_layout

\begin_layout Plain Layout

                                   leg = rep(as.character(max(as.numeric(mzz$leg))
+1), 10)))
\end_layout

\begin_layout Plain Layout

strat_zzl <- 1.5
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

### now the corner
\end_layout

\begin_layout Plain Layout

region_sq <- data.frame(x=c(0,0,3,3,0),
\end_layout

\begin_layout Plain Layout

                        y=c(0,3,3,0,0))
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

n_segs <- 3
\end_layout

\begin_layout Plain Layout

zz <- data.frame(y = c(seq(0, 0.25, len=n_segs),
\end_layout

\begin_layout Plain Layout

                       seq(0.25, 0.5, len=n_segs)),
\end_layout

\begin_layout Plain Layout

                 x = c(seq(0, 0.5, len=n_segs),
\end_layout

\begin_layout Plain Layout

                       seq(0.5, 0, len=n_segs)))
\end_layout

\begin_layout Plain Layout

mzz <- rbind(zz, zz, zz, zz, zz)
\end_layout

\begin_layout Plain Layout

mzz$y <- mzz$y + sort(rep(seq(0.5,2.5, by=0.5), 2*n_segs))
\end_layout

\begin_layout Plain Layout

mzz$leg <- sort(rep(seq(1,10, by=1), 3))
\end_layout

\begin_layout Plain Layout

mzz$x <- mzz$x +0.25
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

zzu <- data.frame(x = c(seq(0, 0.25, len=n_segs),
\end_layout

\begin_layout Plain Layout

                        seq(0.25, 0.5, len=n_segs)),
\end_layout

\begin_layout Plain Layout

                  y = c(seq(0.5, 0, len=n_segs),
\end_layout

\begin_layout Plain Layout

                        seq(0, 0.5, len=n_segs)))
\end_layout

\begin_layout Plain Layout

mzzu <- rbind(zzu, zzu, zzu, zzu, zzu)
\end_layout

\begin_layout Plain Layout

mzzu$x <- mzzu$x + sort(rep(seq(0.25,2.25, by=0.5), 2*n_segs))
\end_layout

\begin_layout Plain Layout

mzzu$leg <- 10+sort(rep(seq(1,10, by=1), 3))
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

corner <- rbind.data.frame(mzz, mzzu)
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

# make the plots
\end_layout

\begin_layout Plain Layout

plot_shape(mzz2, "manyzigzags", strat_mzz)
\end_layout

\begin_layout Plain Layout

plot_shape(tb, "twozigzags", -1.25, xlim=c(-2.5, 0), ylim=c(0,3))
\end_layout

\begin_layout Plain Layout

plot_shape(zzl, "zzl", strat_zzl)
\end_layout

\begin_layout Plain Layout

plot_shape(corner, "corner", 1, xlim=c(0,3), ylim=c(0,3))
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Realised effort for the designs used in the simulations.
 From left to right: good design with even coverage; an 
\begin_inset Quotes eld
\end_inset

iffy
\begin_inset Quotes erd
\end_inset

 design where effort high in one side and low in the other; an 
\begin_inset Quotes eld
\end_inset

iffy
\begin_inset Quotes erd
\end_inset

 design where effort is more sporadically allocated; the bad design, with
 most of the effort in the left and bottom of the survey area.
 In each case the black box around the designs indicates the limits of the
 study area.
 Red dashed lines indicate the boundaries of the strata used with the stratified
 HT estimator (see 
\begin_inset Quotes eld
\end_inset

Models
\begin_inset Quotes erd
\end_inset

).
\begin_inset CommandInset label
LatexCommand label
name "fig:designs"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Models
\begin_inset CommandInset label
LatexCommand label
name "subsec:Models"

\end_inset


\end_layout

\begin_layout Standard
Both spatially explicit models and HT methods were used to estimate abundance
 for each simulation.
 These are enumerated below.
 Since we only include spatial terms in our simulations and we believe that
 in general our spatial effects can be estimated by bivariate smooths (even
 if in this example the underlying densities are better suited to univariate
 smooths, we never know this 
\shape italic
a priori
\shape default
).
 The spatial models are separated into two classes: those which have the
 isotropy property (that a unit change in one direction is considered to
 be equivalent to a unit change in an orthogonal direction, sometimes referred
 to as 
\shape italic
rotational invariance
\shape default
) and those which do not; these are constructed by a 
\shape italic
tensor product
\shape default
 of univariate splines.
 We also test that the setup of the smoother isn't unduly advantageous to
 a particular model by rotating the coordinate system by 45° using the rotation
 matrix: 
\begin_inset Formula 
\[
R=\begin{pmatrix}\cos(\pi/4) & -\sin(\pi/4)\\
\sin(\pi/4) & \cos(\pi/4)
\end{pmatrix}.
\]

\end_inset


\end_layout

\begin_layout Standard
The models tested were (starting with their shorthand code used for plots
 later):
\end_layout

\begin_layout Itemize
Isotropic smooths 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Itemize
TP: thin plate spline
\family typewriter
, bs="tp"
\family default
 
\begin_inset CommandInset citation
LatexCommand citep
key "Wood:2003tc"

\end_inset


\end_layout

\begin_layout Itemize
TPSH: thin plate spline with shrinkage, 
\family typewriter
bs="ts"
\family default
 
\begin_inset CommandInset citation
LatexCommand citep
key "Marra:2011fv"

\end_inset


\end_layout

\begin_layout Itemize
Duchon: Duchon spline, 
\family typewriter
bs="ds", m=c(1, 0.5)
\family default
 
\begin_inset CommandInset citation
LatexCommand citep
key "Miller:2014hc"

\end_inset


\end_layout

\end_deeper
\begin_layout Itemize
Tensor product smooths (smooths listed below were used in both directions)
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Itemize
TPTE: thin plate spline, 
\family typewriter
bs="tp"
\family default
 
\end_layout

\begin_layout Itemize
TPTER: thin plate spline with rotated covariates, 
\family typewriter
bs="tp"
\end_layout

\end_deeper
\begin_layout Itemize
Non-spatially explicit models
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Itemize
HT: Horvitz-Thompson (assuming one stratum, using 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:HT"

\end_inset

)
\end_layout

\begin_layout Itemize
HTstrat: stratified Horvitz-Thompson using strata as shown in Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:designs"

\end_inset


\end_layout

\begin_layout Itemize
HTcovar: Horvitz-Thompson with covariates included (where applicable)
\end_layout

\begin_layout Itemize
HTstratcovar: stratified Horvitz-Thompson with covariates using strata as
 shown in Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:designs"

\end_inset

 (where applicable)
\end_layout

\end_deeper
\begin_layout Standard
Note that for the detection function part of each model we fit a model of
 the same form as the generating model, we do not consider model uncertainty
 or selection for the detection function.
 For simulations where the weather covariate was simulated, all spatial
 models use a detection function with the covariate included, we include
 estimates for HT-based methods both including and not including the weather
 covariate.
 The spatial models used are not 
\emph on
all
\emph default
 the ones that might be considered in practice for a full-on 
\shape italic
bona fide
\shape default
 spatial analysis (e.g., we did not consider soap-film smooths, because there
 are more application-specific insights to set up appropriately), but we
 expect that they should encompass a wide range of ways to respond to data.
\end_layout

\begin_layout Subsection
Software
\end_layout

\begin_layout Standard
All simulations were generated using 
\family typewriter
DSsim
\family default
 (R package version 1.0.6), with a wrapper scripts used to generate data that
 could be easily analysed, these are collected in the R package 
\family typewriter
ltdesigntester
\family default
 (available at 
\begin_inset Flex URL
status open

\begin_layout Plain Layout

http://github.com/dill/ltdesigntester
\end_layout

\end_inset

); a vignette is provided with the package to illustrate its use.
 Detection functions were fitted in 
\family typewriter
Distance
\family default
 (R package version 0.9.6) and spatial models were fitted using
\family typewriter
 dsm
\family default
 (R package version 2.2.12).
 Code for the simulations and this paper is available at 
\begin_inset Flex URL
status open

\begin_layout Plain Layout

http://github.com/dill/spatlaugh
\end_layout

\end_inset

.
\end_layout

\begin_layout Subsection
Metrics
\end_layout

\begin_layout Standard
In order to assess the performance of the abundance estimates, we use two
 graphical methods.
\end_layout

\begin_layout Subsubsection
Bias
\end_layout

\begin_layout Standard
We can simply calculate the bias (
\begin_inset Formula $\hat{N}-N_{\text{truth}}$
\end_inset

) and plot boxplots of these values.
 Bias may only be interesting in certain situations, for example when we
 are very uncertain about abundance, the bias may not be our main concern.
\end_layout

\begin_layout Subsubsection
Where does the truth lie in the distribution of the model?
\end_layout

\begin_layout Standard
If we know the true abundance in our simulation (
\begin_inset Formula $N_{\text{truth}}$
\end_inset

), then we can derive a useful diagnostic measure by asking at what quantile
 does 
\begin_inset Formula $N_{\text{truth}}$
\end_inset

 lie in the distribution implied by the model (i.e., find 
\begin_inset Formula $\mathbb{P}[N_{\text{truth}}\leq\hat{N}]$
\end_inset

).
 Here we assume log-normally distributed 
\begin_inset Formula $\hat{N}$
\end_inset

, so use the usual formulae to find the resulting quantiles.
 This summary 
\begin_inset Quotes eld
\end_inset

self-confidence
\begin_inset Quotes erd
\end_inset

 statistic gives some idea of both bias and variance.
 If the model is working as it should, then the self-confidence quantile
 should be uniformly distributed across simulations.
 If the distribution of the statistic is skewed to either end then we can
 infer under- or over- estimation of abundance for a particular estimator.
 Skew to both ends indicates overconfidence.
 A flat distribution shows good performance, whereas a 
\begin_inset Quotes eld
\end_inset

dome
\begin_inset Quotes erd
\end_inset

 in the middle indicates a conservative estimate in the sense that confidence
 intervals are slightly too wide.
 This more conservative behaviour seems desirable, since in practice we
 probably have not accounted for all of the sources of uncertainty in our
 model.
 An example of plots of this statistic is given in Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:self-confidence"

\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<self-confidence, fig.width=9, fig.height=3, echo=FALSE, message=FALSE, warning=F
ALSE>>=
\end_layout

\begin_layout Plain Layout

# an example in self-confidence
\end_layout

\begin_layout Plain Layout

# quick plot to show what those plots should look like in different 
\end_layout

\begin_layout Plain Layout

# situations
\end_layout

\begin_layout Plain Layout

library(ggplot2)
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

# number of reps 
\end_layout

\begin_layout Plain Layout

n <- 1000
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

# when things go "right" -- flat distribution 
\end_layout

\begin_layout Plain Layout

dat <- data.frame(scenario = "ok", quantile = runif(n))
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

# spike on the left => +ve bias
\end_layout

\begin_layout Plain Layout

nb <- rexp(2*n, 2) 
\end_layout

\begin_layout Plain Layout

nb <- nb[nb<=1 & nb >=0] 
\end_layout

\begin_layout Plain Layout

nb <- nb[1:n] 
\end_layout

\begin_layout Plain Layout

dat <- rbind(dat, data.frame(scenario = "+ve bias", quantile = nb))
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

# spike on the right => -ve bias 
\end_layout

\begin_layout Plain Layout

nb <- 1-rexp(2*n, 2) 
\end_layout

\begin_layout Plain Layout

nb <- nb[nb<=1 & nb >=0] 
\end_layout

\begin_layout Plain Layout

nb <- nb[1:n] 
\end_layout

\begin_layout Plain Layout

dat <- rbind(dat, data.frame(scenario = "-ve bias", quantile = nb))
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

# overconfidence
\end_layout

\begin_layout Plain Layout

nb <- rnorm(2*n, mean=0.5, sd=0.2)
\end_layout

\begin_layout Plain Layout

nb <- c(nb-0.5, nb+0.5)
\end_layout

\begin_layout Plain Layout

nb <- nb[nb<=1 & nb >=0]
\end_layout

\begin_layout Plain Layout

nb <- nb[sample(1:(2*n), n)] 
\end_layout

\begin_layout Plain Layout

dat <- rbind(dat, data.frame(scenario = "Over confident", quantile = nb))
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

# what we'd like to see 
\end_layout

\begin_layout Plain Layout

nb <- rnorm(2*n, mean=0.5, sd=0.35) 
\end_layout

\begin_layout Plain Layout

nb <- nb[nb<=1 & nb >=0] 
\end_layout

\begin_layout Plain Layout

nb <- nb[1:n] 
\end_layout

\begin_layout Plain Layout

dat <- rbind(dat, data.frame(scenario = "Conservative", quantile = nb))
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

p <- ggplot(dat) +
\end_layout

\begin_layout Plain Layout

      geom_histogram(aes(quantile), binwidth=0.05)+
\end_layout

\begin_layout Plain Layout

      scale_x_continuous(limits=c(0,1), breaks=seq(0,1,len=5),
\end_layout

\begin_layout Plain Layout

                         labels=c("0","0.25","0.5","0.75","1"))+
\end_layout

\begin_layout Plain Layout

      facet_wrap(~scenario, nrow=1) +
\end_layout

\begin_layout Plain Layout

      geom_vline(xintercept=0.5) +
\end_layout

\begin_layout Plain Layout

      labs(x="Quantile", y="Count") +
\end_layout

\begin_layout Plain Layout

      theme_minimal()
\end_layout

\begin_layout Plain Layout

print(p)
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Illustration of the 
\begin_inset Quotes eld
\end_inset

self-confidence
\begin_inset Quotes erd
\end_inset

 measure.
 From left to right: 
\begin_inset Quotes eld
\end_inset

ok
\begin_inset Quotes erd
\end_inset

 denotes shows a plot with flat quantile distribution (no problems), 
\begin_inset Quotes eld
\end_inset

+ve bias
\begin_inset Quotes erd
\end_inset

 shows the spike at 1 indicating positive bias, 
\begin_inset Quotes eld
\end_inset

-ve bias
\begin_inset Quotes erd
\end_inset

 shows a large spike at zero indicating negative bias, 
\begin_inset Quotes eld
\end_inset

overconfident
\begin_inset Quotes erd
\end_inset

 shows a spike with little spread, 
\begin_inset Quotes eld
\end_inset

conservative
\begin_inset Quotes erd
\end_inset

 shows behaviour where the confidence intervals are slightly too wide, which
 we might prefer.
\begin_inset CommandInset label
LatexCommand label
name "fig:self-confidence"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Section
Results
\begin_inset CommandInset label
LatexCommand label
name "sec:Results"

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<get-data-format, echo=FALSE, message=FALSE, warning=FALSE>>=
\end_layout

\begin_layout Plain Layout

library(plyr)
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

# one for each distribution/detectability
\end_layout

\begin_layout Plain Layout

f_names <- list.files(path="../simulation_study/",  pattern="*
\backslash

\backslash
.RData", 
\end_layout

\begin_layout Plain Layout

                      full.names=TRUE)
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

# lookup for model names to short descriptions
\end_layout

\begin_layout Plain Layout

model_name_lookup <- c("HT",
\end_layout

\begin_layout Plain Layout

                       "HTcovar",
\end_layout

\begin_layout Plain Layout

                       "HTstrat",
\end_layout

\begin_layout Plain Layout

                       "HTstratcovar",
\end_layout

\begin_layout Plain Layout

                       "Duchon",
\end_layout

\begin_layout Plain Layout

                       "TPTE",
\end_layout

\begin_layout Plain Layout

                       "TP",
\end_layout

\begin_layout Plain Layout

                       "TPSH",
\end_layout

\begin_layout Plain Layout

                       "TPR",
\end_layout

\begin_layout Plain Layout

                       "TPTER")
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

names(model_name_lookup) <- c("HT",
\end_layout

\begin_layout Plain Layout

                              "HT_cov",
\end_layout

\begin_layout Plain Layout

                              "HT_strat",
\end_layout

\begin_layout Plain Layout

                              "HT_strat_cov",
\end_layout

\begin_layout Plain Layout

                              "m_xy_ds",
\end_layout

\begin_layout Plain Layout

                              "m_xy_te",
\end_layout

\begin_layout Plain Layout

                              "m_xy_tp",
\end_layout

\begin_layout Plain Layout

                              "m_xy_ts",
\end_layout

\begin_layout Plain Layout

                              "m_xyr_tp",
\end_layout

\begin_layout Plain Layout

                              "m_xyr_te")
\end_layout

\begin_layout Plain Layout

model_name_lookup <- factor(model_name_lookup, levels=c("HT", "HTcovar",
 "HTstrat",
\end_layout

\begin_layout Plain Layout

                                                        "HTstratcovar",
 "Duchon", "TPTE",
\end_layout

\begin_layout Plain Layout

                                                        "TP", "TPSH", "TPR",
 "TPTER"))
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

huge_res <- c()
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

# now loop over the files
\end_layout

\begin_layout Plain Layout

for(i in seq_along(f_names)){
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

  load(f_names[i])
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

  # print the name of this scenario as the header
\end_layout

\begin_layout Plain Layout

  f_names[i] <- sub("../simulation_study//", "", f_names[i], fixed=TRUE)
\end_layout

\begin_layout Plain Layout

  f_names[i] <- sub(".RData", "", f_names[i])
\end_layout

\begin_layout Plain Layout

  big_res$scenario <- f_names[i]
\end_layout

\begin_layout Plain Layout

  big_res$model <- as.character(big_res$model)
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

  # remove the tprs rotated as it doesn't matter(!) same as tprs (isotropy)
\end_layout

\begin_layout Plain Layout

  big_res <- big_res[big_res$model != "m_xyr_tp",]
\end_layout

\begin_layout Plain Layout

  # make nice model names
\end_layout

\begin_layout Plain Layout

  big_res$model <- model_name_lookup[big_res$model]
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

  ## WARNING: magic numbers below!!
\end_layout

\begin_layout Plain Layout

  # bias
\end_layout

\begin_layout Plain Layout

  big_res$bias <- big_res$N-500
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

  # separate out the scenario definition
\end_layout

\begin_layout Plain Layout

  big_res$density <- sub("([a-z]+)-[a-z]+-[a-z]+", "
\backslash

\backslash
1", big_res$scenario[1])
\end_layout

\begin_layout Plain Layout

  big_res$design <- sub("[a-z]+-([a-z]+)-[a-z]+", "
\backslash

\backslash
1", big_res$scenario[1])
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

  if(big_res$design == "tb"){
\end_layout

\begin_layout Plain Layout

	big_res$design <- "twozigzag"
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

  if(!grepl("covar", big_res$scenario[1])){
\end_layout

\begin_layout Plain Layout

    big_res$df <- sub("[a-z]+-[a-z]+-([a-z]+)", "
\backslash

\backslash
1", big_res$scenario[1])
\end_layout

\begin_layout Plain Layout

    big_res$covar <- FALSE
\end_layout

\begin_layout Plain Layout

  }else{
\end_layout

\begin_layout Plain Layout

    big_res$covar <- TRUE
\end_layout

\begin_layout Plain Layout

	big_res$df <- "covar"
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

  huge_res <- rbind(huge_res, big_res)
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Standard
We experimented with possible combinations of simulation scenarios based
 on the models above.
 In each scenario, we tested all of the modelling options listed above and
 recorded the metrics from the previous section.
 The density surfaces described in Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:Density-surfaces"

\end_inset

 only describe the 
\shape italic
relative
\shape default
 density of the population in question.
 We (arbitrarily) fixed the total population size to be 500 individuals
 for each simulation.
\end_layout

\begin_layout Standard
Note that the aim here is not to show 
\shape italic
which
\shape default
 spatial model is best out of those presented here, it is to show that there
 are large differences between the HT estimators and the spatial models
 in particular situations.
 Differences between the spatial models can be attributed to the model formulati
on process, for example in the cases where the gradient was simply right-left,
 left-right or flat, fitting a bivariate spatial model will likely not perform
 particularly well as it is too flexible.
 Additionally, none of the models underwent model checking in the usual
 way 
\begin_inset CommandInset citation
LatexCommand citep
before "e.g.,"
key "Miller:2013fq,Winiarski:2014bc"

\end_inset

, so the spatial models represent the 
\begin_inset Quotes eld
\end_inset

dumbest possible
\begin_inset Quotes erd
\end_inset

 spatial model, without any thought to checking or calibration.
\end_layout

\begin_layout Standard
We summarise the results in the remaining subsections of this section.
 Bias and 
\begin_inset Quotes eld
\end_inset

self-confidence
\begin_inset Quotes erd
\end_inset

 plots for all simulations are provided in Appendix 2, results (in RData
 format) are include in the project GitHub repository.
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<plot-funcs, echo=FALSE, message=FALSE, warning=FALSE>>=
\end_layout

\begin_layout Plain Layout

library(ggplot2)
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

# plot quantiles
\end_layout

\begin_layout Plain Layout

plot_quantile <- function(dat, covar){
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

  #ndat <- ddply(dat, .(df,design,model),  summarize, thisn=length(df))
\end_layout

\begin_layout Plain Layout

  #ndat$df<-NULL
\end_layout

\begin_layout Plain Layout

  #ndat <- unique(ndat)
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

  # put the designs in order
\end_layout

\begin_layout Plain Layout

  if(length(unique(dat$design)==3)){
\end_layout

\begin_layout Plain Layout

    dat$design <- factor(dat$design, c("manyzigzags", "zzl", "twozigzag"))
\end_layout

\begin_layout Plain Layout

  }else if(length(unique(dat$design)==2)){
\end_layout

\begin_layout Plain Layout

    dat$design <- factor(dat$design, c("manyzigzags", "zzl"))
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

  p <- ggplot(dat)+
\end_layout

\begin_layout Plain Layout

        geom_histogram(aes(quantile))+
\end_layout

\begin_layout Plain Layout

        geom_vline(xintercept=0.5, colour="red") +
\end_layout

\begin_layout Plain Layout

        #geom_text(aes(x=0.8, y=60, label=thisn), data=ndat) +
\end_layout

\begin_layout Plain Layout

        labs(x="Quantile", y="Count") +
\end_layout

\begin_layout Plain Layout

        theme_minimal()
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

  p <- p + facet_grid(model~design,
\end_layout

\begin_layout Plain Layout

                      labeller=function(labels, multi_line=FALSE){
\end_layout

\begin_layout Plain Layout

                       label_value(labels, multi_line)
\end_layout

\begin_layout Plain Layout

                      })
\end_layout

\begin_layout Plain Layout

  print(p)
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

# bias plotter
\end_layout

\begin_layout Plain Layout

plot_bias <- function(dat, covar, ylim=c(-500, 500)){
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

  # reorder the detection functions
\end_layout

\begin_layout Plain Layout

  dat$df <- factor(dat$df, c("good","bad","covar"))
\end_layout

\begin_layout Plain Layout

  if(length(unique(dat$design)==3)){
\end_layout

\begin_layout Plain Layout

    dat$design <- factor(dat$design, c("manyzigzags", "zzl", "twozigzag"))
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

  p <- ggplot(dat)+
\end_layout

\begin_layout Plain Layout

    geom_boxplot(aes(model, bias), outlier.size = 0.75) +
\end_layout

\begin_layout Plain Layout

    labs(y="Bias", x="Model") +
\end_layout

\begin_layout Plain Layout

    coord_cartesian(ylim = ylim) +
\end_layout

\begin_layout Plain Layout

    theme_minimal() +
\end_layout

\begin_layout Plain Layout

    facet_grid(design~df,
\end_layout

\begin_layout Plain Layout

               labeller=function(labels, multi_line=FALSE){
\end_layout

\begin_layout Plain Layout

                          label_value(labels, multi_line)
\end_layout

\begin_layout Plain Layout

                        }) +
\end_layout

\begin_layout Plain Layout

    geom_hline(aes(yintercept=0), colour="red") +
\end_layout

\begin_layout Plain Layout

    theme(axis.text.x = element_text(angle=90, hjust=1))
\end_layout

\begin_layout Plain Layout

  print(p)
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
General comments
\end_layout

\begin_layout Standard
Before looking at where particular models succeeded or failed, we first
 look at general trends in the results.
 First we note that for any design, flat densities are easy to estimate
 for HT-type methods.
 We note that the rotated coordinate spatial models (TPTER) sometimes perform
 better than their non-rotated variants; we believe this is down to the
 non-rotated models having another direction of variability (in the 
\begin_inset Formula $y$
\end_inset

 direction) that is effectively unused (and which we would therefore like
 to be estimated as a zero effect), but that may pick up on minor variations
 due to sampling variability.
 In the rotated models both coordinates are used, so estimating an effect
 of exactly zero for the 
\begin_inset Formula $y$
\end_inset

 component is not an issue.
\end_layout

\begin_layout Subsection
Designs with good coverage work well
\end_layout

\begin_layout Standard
As expected, when coverage is even (Appendix 2, plots labelled 
\begin_inset Quotes eld
\end_inset

manyzigzags
\begin_inset Quotes erd
\end_inset

), the methods based on HT estimators perform well in terms of bias in estimatin
g 
\begin_inset Formula $\hat{N}$
\end_inset

.
 Only when the detectability becomes particularly bad does the 
\begin_inset Quotes eld
\end_inset

self-confidence
\begin_inset Quotes erd
\end_inset

 diagnostic start to look bad for the HT estimators (at which point it also
 begins to look worse for the spatial models).
 
\end_layout

\begin_layout Subsection
Uneven coverage is bad
\end_layout

\begin_layout Standard
Moving to an uneven design like 
\begin_inset Quotes eld
\end_inset

zzl
\begin_inset Quotes erd
\end_inset

 or 
\begin_inset Quotes eld
\end_inset

twozigzag
\begin_inset Quotes erd
\end_inset

 makes unbiased estimation of abundance much harder and we see all models
 perform worse.
 Though in particular, we see that the unstratified HT estimate (HT) perform
 much worse and the stratified HT also perform poorly — this is particularly
 revealing as in our simulations, the 
\begin_inset Quotes eld
\end_inset

correct
\begin_inset Quotes erd
\end_inset

 stratification was provided to the estimator, a luxury that we do not have
 in real life.
 The 
\begin_inset Quotes eld
\end_inset

self-confidence
\begin_inset Quotes erd
\end_inset

 diagnostic plots also show a shift in all models, though again the HT-based
 methods perform worse than the spatial models on the whole.
 If performance is poor with the correct stratification, then we can assume
 that things will be much worse when stratifications are decided 
\shape italic
a priori
\shape default
 based on logistical constraints rather than information on true distribution.
 This is likely amplified when density is not a simple gradient.
\end_layout

\begin_layout Standard
Things get substantially worse across the board if the gradient runs against
 a poor design.
 This gets even worse when weather confounds the problem.
 For example, Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:quantile-rl-w"

\end_inset

 right panel (
\begin_inset Quotes eld
\end_inset

zzl
\begin_inset Quotes erd
\end_inset

 design with right-left density, weather covariate) shows poor performance
 for all models.
 In this case the combination of confounding and low effort where there
 are lots of animals means that nothing can be done — it is probably best
 to give up on such data.
\end_layout

\begin_layout Subsection
Covariates make things complicated
\end_layout

\begin_layout Standard
Ignoring the even coverage design, once the weather covariate is included
 in the data generation process, things look much worse for the models which
 do not include it.
 Both bias and 
\begin_inset Quotes eld
\end_inset

self-confidence
\begin_inset Quotes erd
\end_inset

 show that stratification and including the covariate do improve the HT
 estimates, though again we are assuming the correct stratification scheme.
\end_layout

\begin_layout Standard
The most complicated simulation setup (corner design with diagonal density
 gradient and weather covariate) highlights a more usual situation than
 the others — we are often confronted with uneven coverage (non)-designs,
 densities that are complex and weather is almost always an issue.
 Given the performance in the simpler situations, this scenario was bound
 to be more taxing for the HT-based estimation methods (Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:biasdiag"

\end_inset

).
 The 
\begin_inset Quotes eld
\end_inset

self-confidence
\begin_inset Quotes erd
\end_inset

 measure is rather bad for all HT-based methods, but the performance of
 the spatial models (Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:quantile-diag-w"

\end_inset

) looks like the 
\begin_inset Quotes eld
\end_inset

conservative
\begin_inset Quotes erd
\end_inset

 example shown in Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:self-confidence"

\end_inset

 .
\end_layout

\begin_layout Section
Discussion
\begin_inset CommandInset label
LatexCommand label
name "sec:Discussion"

\end_inset


\end_layout

\begin_layout Standard
Simulations presented here highlight potential issues when HT estimators
 are used in the case where animal distribution is not constant within a
 given stratum.
 Violation of the assumption of flat density within a stratum causes issues
 when coverage is uneven.
 Though the designs and densities presented here are relatively simple,
 the problems that arise only become amplified with added complexity.
 We do not believe that the most complex scenario (corner design with diagonal
 density gradient and weather covariate) is in any way pathological — on
 the contrary, we think it represents a fairly mild version of what is often
 seen in the field.
 A more realistic version of this scenario would involve incomplete transects
 (holes in the transects) and a more complex density surface.
\end_layout

\begin_layout Standard
In general we see that spatial models, even when applied in a very naïve
 way, provide a coherent way to think about modelling phenomena that are,
 by their very nature, spatial.
 Although formulating, fitting, checking and validating spatial models is
 more complex than simply using HT-type methods to obtain density, the added
 time and resources clearly leads to more reliable results.
 It is worth noting that here for the majority of the density surfaces tested
 (aside from diagonal case) the spatial models were all overparameterised,
 in that the 
\begin_inset Quotes eld
\end_inset

correct
\begin_inset Quotes erd
\end_inset

 model would be a single smooth of 
\begin_inset Formula $x$
\end_inset

 for the left-right and right-left gradients, not a bivariate smooth of
 
\begin_inset Formula $x$
\end_inset

 and 
\begin_inset Formula $y$
\end_inset

.
 Nevertheless, the spatial models performed well.
 If the true density is flat, estimating that density surface (equivalently
 estimating almost all of the coefficients of the bivariate smooths to be
 zero), as would be assumed by HT, when sampling of the density surface
 is not even, is very difficult (not to mention an unrealistic situation).
 In these cases the spatial model performed almost as well as the HT estimator.
\end_layout

\begin_layout Standard
The 
\family typewriter
ltdesigntester
\family default
 package developed for this paper is quite general and can be used for any
 design or density surface.
 We considered only a two-level 
\begin_inset Quotes eld
\end_inset

weather
\begin_inset Quotes erd
\end_inset

 covariate.
 We encourage investigators to input their current designs and use the supplied
 simple density surfaces to test how well abundance can be estimated.
 The software could potentially be adapted and extended in numerous ways,
 perhaps linked to planned developments in the 
\family typewriter
dsm
\family default
 package such as allowance for spatial variation in group size.
\end_layout

\begin_layout Standard
We envisage three possible outcomes from testing HT-acceptability, starting
 with the approaches/software described here, but not necessarily finishing
 there:
\end_layout

\begin_layout Enumerate
An HT analysis should be OK;
\end_layout

\begin_layout Enumerate
HT would be risky, but spatial modelling might deliver an acceptable point
 estimate and variance estimate;
\end_layout

\begin_layout Enumerate
The data are so imbalanced that spatial modelling is unlikely to deliver
 a reliable estimate.
\end_layout

\begin_layout Standard
Clearly, the analyses and software proposed here can only differentiate
 directly between 1.
 and 2./3.
 If a spatial model is to be used instead of HT, then the appropriate model
 — which will use the real locations of sightings, not just the total number
 — may well be outside the range of simple models in our tests (e.g., if there
 are edge effects requiring the use of, e.g., soap film smoothers).
 It may of course also be necessary to enlarge the model to deal with group
 size etc.
 Selecting a preferred spatial model, and reporting appropriate diagnostics
 for it, is beyond the scope of this particular document, but see 
\begin_inset CommandInset citation
LatexCommand citep
before "IWC/65b/RMP11;"
key "Chandler:2005hp,Wood:2006dc,Augustin:2009gv,Augustin:2012ck,Augustin:2013gf,Miller:2013fq,Winiarski:2014bc"

\end_inset


\series bold
.
 
\end_layout

\begin_layout Standard
It is worth pointing out that we have deliberately avoided using the actual
 location of sightings.
 Of course, the sighting-locations themselves could be used to directly
 fit a spatial model, so why not use that as the point-of-comparison with
 HT? Our motivation is twofold: first, actually picking a good spatial model
 for a real dataset is not something that can be automated; second, especially
 if there are not many sightings, the real density surface is very uncertain,
 and it is 
\begin_inset Quotes eld
\end_inset

putting the cart before the horse
\begin_inset Quotes erd
\end_inset

 to assume that a spatial model fitted to limited data will actually pick
 the truth accurately.
 Instead, our approach is a robustness test to assess the survey tracks
 against a range of density surface scenarios, and as such should be safer.
 The possible downside is that, if animal density really is quite uniform,
 then an uneven sampling design might fail our HT-acceptability checks even
 though the actual estimate would be OK.
 But this is hardly a disaster; all that would be needed to rescue the data,
 is to proceed to fitting a spatial model 
\begin_inset Quotes eld
\end_inset

for real
\begin_inset Quotes erd
\end_inset

.
 For many datasets, this is certainly not an overwhelming task with modern
 software such as 
\family typewriter
dsm
\family default
.
\end_layout

\begin_layout Part*
\start_of_appendix
Appendices
\end_layout

\begin_layout Section*
Appendix 1 - Data format for 
\family typewriter
Distance
\family default
 and 
\family typewriter
dsm
\end_layout

\begin_layout Standard
In this appendix we describe the data format required for the two packages
 used above.
 The text below is adapted from their respective manuals.
\end_layout

\begin_layout Subsection*

\family typewriter
Distance
\end_layout

\begin_layout Standard
A single 
\family typewriter
data.frame 
\family default
should be provided to
\family typewriter
 Distance
\family default
 to fit a detection function, or to estimate abundance using the HT estimator.
 To simply fit a detection function we require the following columns in
 our data:
\end_layout

\begin_layout Itemize

\family typewriter
distance
\family default
 observed perpendicular distance to observation from the line
\end_layout

\begin_layout Itemize

\family typewriter
object
\family default
 an unique identifier for the observation
\end_layout

\begin_layout Standard
If one wishes to estimate abundance, the following columns are also required:
\end_layout

\begin_layout Itemize

\family typewriter
Sample.Label
\family default
 Identifier for the sample (transect) 
\end_layout

\begin_layout Itemize

\family typewriter
Effort
\family default
 effort for this transect (transect length) 
\end_layout

\begin_layout Itemize

\family typewriter
Region.Label
\family default
 label for a given stratum
\end_layout

\begin_layout Itemize

\family typewriter
Area
\family default
 area of the strata
\end_layout

\begin_layout Standard
Each row corresponds to one observation.
 In some cases a given transect or even stratum may contain zero observations.
 In this case the transect(s) are still included, along with their effort,
 but their corresponding 
\family typewriter
object
\family default
 and 
\family typewriter
distance
\family default
 fields are set to 
\begin_inset Quotes eld
\end_inset

not available
\begin_inset Quotes erd
\end_inset

 (in R 
\begin_inset Quotes eld
\end_inset


\family typewriter
NA
\family default

\begin_inset Quotes erd
\end_inset

).
\end_layout

\begin_layout Subsection*

\family typewriter
dsm
\end_layout

\begin_layout Standard
Two 
\family typewriter
data.frame
\family default
s must be provided to 
\family typewriter
dsm
\family default
.
 They are referred to as 
\family typewriter
observation.data
\family default
 and 
\family typewriter
segment.data
\family default
.
 The 
\family typewriter
segment.data
\family default
 table has the sample identifiers which define the segments, the corresponding
 effort (line length) expended and the environmental covariates that will
 be used to model abundance/density.
 
\family typewriter
observation.data
\family default
 provides a link table between the observations used in the detection function
 and the samples (segments), so that we can aggregate the observations to
 the segments (i.e.
 
\family typewriter
observation.data
\family default
 is a "look-up table" between the observations and the segments).
\end_layout

\begin_layout Subsubsection*

\family typewriter
observation.data
\end_layout

\begin_layout Standard
The observation 
\family typewriter
data.frame
\family default
 must have (at least) the following columns: 
\end_layout

\begin_layout Itemize

\family typewriter
object
\family default
 unique object identifier
\end_layout

\begin_layout Itemize

\family typewriter
Sample.Label
\family default
 the identifier for the segment that the observation occurred in 
\end_layout

\begin_layout Itemize

\family typewriter
size
\family default
 the size of each observed group (e.g 1 if all animals occurred individually)
 
\end_layout

\begin_layout Itemize

\family typewriter
distance
\family default
 distance to observation
\end_layout

\begin_layout Standard
One can often also use 
\family typewriter
observation.data
\family default
 to fit a detection function (so additional columns for detection function
 covariates are allowed in this table).
\end_layout

\begin_layout Subsubsection*

\family typewriter
segment.data
\end_layout

\begin_layout Standard
The segment 
\family typewriter
data.frame
\family default
 must have (at least) the following columns:
\end_layout

\begin_layout Itemize

\family typewriter
Effort
\family default
 the effort (in terms of length of the segment) 
\end_layout

\begin_layout Itemize

\family typewriter
Sample.Label
\family default
 identifier for the segment (unique!) 
\end_layout

\begin_layout Itemize
??? environmental covariates, for example: location (projected latitude
 and longitude), and other relevant covariates (sea surface temperature,
 bathymetry etc).
 
\end_layout

\begin_layout Section*
Appendix 2 - Full simulation results
\end_layout

\begin_layout Standard
This appendix gives all plots of results from the simulations that were
 run.
 Plots are aggregated by underlying density used to generate the data.
 Note that boxplots are clipped at their limits, so some extreme outliers
 may not be shown.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<plot-results-bias-f, fig.width=9, fig.height=9, echo=FALSE, message=FALSE,
 warning=FALSE>>=
\end_layout

\begin_layout Plain Layout

huge_res_f <- huge_res[huge_res$density=="f",]
\end_layout

\begin_layout Plain Layout

plot_bias(huge_res_f, FALSE)
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Bias in abundance for each of the models per simulation scenario for the
 flat density.
 Columns give the detection function type (see Section
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:Detectability"

\end_inset

) and rows give the design used (see Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:Designs"

\end_inset

).
 With a flat density all models perform relatively well, even when the detectabi
lity is low (though there is some negative bias).
 
\begin_inset CommandInset label
LatexCommand label
name "fig:biasf"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<plot-results-bias-lr, fig.width=9, fig.height=9, echo=FALSE, message=FALSE,
 warning=FALSE>>=
\end_layout

\begin_layout Plain Layout

huge_res_lr <- huge_res[huge_res$density=="lr",]
\end_layout

\begin_layout Plain Layout

plot_bias(huge_res_lr, FALSE)
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Bias in abundance for each of the models per simulation scenario for the
 left-right gradient density.
 Columns give the detection function type (see Section
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:Detectability"

\end_inset

) and rows give the design used (see Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:Designs"

\end_inset

).
 In this case for the 
\begin_inset Quotes eld
\end_inset

zzl
\begin_inset Quotes erd
\end_inset

 design, most of the effort is concentrated on the higher densities, the
 low effort side is where there are fewer animals, the HT-based methods
 perform poorly here, as do some of the spatial models.
 With such a small amount of effort, it would be hard to detect that the
 gradient was to blame for low numbers of sightings.
 For the covariate analysis, high detectability coincides with high density
 and high effort, so the good performance of the stratified HT and spatial
 models is likely down to a feature of the confounding between density and
 covariate value (hence the poorer performance of the non-rotationally invariant
 TPTER model).
 
\begin_inset CommandInset label
LatexCommand label
name "fig:biaslr"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<plot-results-bias-rl, fig.width=9, fig.height=9, echo=FALSE, message=FALSE,
 warning=FALSE>>=
\end_layout

\begin_layout Plain Layout

huge_res_rl <- huge_res[huge_res$density=="rl",]
\end_layout

\begin_layout Plain Layout

plot_bias(huge_res_rl, FALSE)
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Bias in abundance for each of the models per simulation scenario for the
 right-left gradient density.
 Columns give the detection function type (see Section
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:Detectability"

\end_inset

) and rows give the design used (see Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:Designs"

\end_inset

).
 Here the 
\begin_inset Quotes eld
\end_inset

zzl
\begin_inset Quotes erd
\end_inset

 design allocates more effort to the low density areas, this leads to the
 non-stratified HT-based estimators to overestimate abundance (assuming
 high abundance everywhere); stratification improves this somewhat (assuming
 the correct stratification) but the spatial models are able to pick up
 on the distribution gradient.
 For the covariate analysis, high detectability coincides with low density
 and high effort, leading to bias in the abundance estimates; spatial models
 have a much greater spread of estimates, obtaining the true abundance at
 least some of the time.
\begin_inset CommandInset label
LatexCommand label
name "fig:biasrl"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<plot-results-bias-diag, fig.width=9, fig.height=9, echo=FALSE, message=FALSE,
 warning=FALSE>>=
\end_layout

\begin_layout Plain Layout

huge_res_diag <- huge_res[huge_res$density=="diag",]
\end_layout

\begin_layout Plain Layout

plot_bias(huge_res_diag, FALSE, ylim=c(-275, 1000))
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Bias in abundance for each of the models per simulation scenario for the
 diagonal gradient density.
 In this case the stratification of the corner design is somewhat arbitrary
 and there is a large extrapolation to the top right of the survey area
 (see Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:designs"

\end_inset

) where the flat density assumption of the HT-based methods fail.
 Spatial models perform well, aside from the tensor product of thin plate
 splines (TPTE).
 
\begin_inset CommandInset label
LatexCommand label
name "fig:biasdiag"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<plot-results-selfconfidence-f-good, fig.width=9, fig.height=9, echo=FALSE,
 message=FALSE, warning=FALSE>>=
\end_layout

\begin_layout Plain Layout

huge_res_f <- huge_res[huge_res$density=="f" & huge_res$df=="good",]
\end_layout

\begin_layout Plain Layout

plot_quantile(huge_res_f)
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Histograms of the 
\begin_inset Quotes eld
\end_inset

self-confidence
\begin_inset Quotes erd
\end_inset

 measure for each model for the flat density surface with a 
\begin_inset Quotes eld
\end_inset

good
\begin_inset Quotes erd
\end_inset

 detection function.
 Rows are the models (see Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:Models"

\end_inset

) and columns give the design (see Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:Designs"

\end_inset

).
 Here we see generally good behaviour in all models, though the spatial
 models are slightly positively biased, which is likely down to model over
 parametrisation (smooths should be estimated with zero effects, which is
 hard).
 
\begin_inset CommandInset label
LatexCommand label
name "fig:quantile-f-good"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<plot-results-selfconfidence-lr-good, fig.width=9, fig.height=9, echo=FALSE,
 message=FALSE, warning=FALSE>>=
\end_layout

\begin_layout Plain Layout

huge_res_lr <- huge_res[huge_res$density=="lr" & huge_res$df=="good",]
\end_layout

\begin_layout Plain Layout

plot_quantile(huge_res_lr)
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Histograms of the 
\begin_inset Quotes eld
\end_inset

self-confidence
\begin_inset Quotes erd
\end_inset

 measure for each model for the left-right density surface with a 
\begin_inset Quotes eld
\end_inset

good
\begin_inset Quotes erd
\end_inset

 detection function.
 Rows are the models (see Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:Models"

\end_inset

) and columns give the design (see Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:Designs"

\end_inset

).
 In this case for the 
\begin_inset Quotes eld
\end_inset

zzl
\begin_inset Quotes erd
\end_inset

 design, most of the effort is concentrated on the higher densities, the
 low effort side is where there are fewer animals, as seen in Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:biaslr"

\end_inset

, stratification improves things somewhat, though using the rotated covariates
 makes the spatial model's job easier (again there is an issue with model
 specification, as we should really only build a model with a smooth of
 
\begin_inset Formula $x$
\end_inset

 in this case).
 
\begin_inset CommandInset label
LatexCommand label
name "fig:quantile-lr-good"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<plot-results-selfconfidence-rl-good, fig.width=9, fig.height=9, echo=FALSE,
 message=FALSE, warning=FALSE>>=
\end_layout

\begin_layout Plain Layout

huge_res_rl <- huge_res[huge_res$density=="rl" & huge_res$df=="good",]
\end_layout

\begin_layout Plain Layout

plot_quantile(huge_res_rl)
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Histograms of the 
\begin_inset Quotes eld
\end_inset

self-confidence
\begin_inset Quotes erd
\end_inset

 measure for each model for the right-left density surface with a 
\begin_inset Quotes eld
\end_inset

good
\begin_inset Quotes erd
\end_inset

 detection function.
 Rows are the models (see Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:Models"

\end_inset

) and columns give the design (see Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:Designs"

\end_inset

).
 Here the 
\begin_inset Quotes eld
\end_inset

zzl
\begin_inset Quotes erd
\end_inset

 design allocates more effort to the low density areas, as in Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:biasrl"

\end_inset

 non-stratified HT estimation is positively biased, stratification improves
 this but the spatial models are better able to estimate the gradient.
 
\begin_inset CommandInset label
LatexCommand label
name "fig:quantile-rl-good"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<plot-results-selfconfidence-f-bad, fig.width=9, fig.height=9, echo=FALSE,
 message=FALSE, warning=FALSE>>=
\end_layout

\begin_layout Plain Layout

huge_res_f <- huge_res[huge_res$density=="f" & huge_res$df=="bad",]
\end_layout

\begin_layout Plain Layout

plot_quantile(huge_res_f)
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Histograms of the 
\begin_inset Quotes eld
\end_inset

self-confidence
\begin_inset Quotes erd
\end_inset

 measure for each model for the flat density surface with a 
\begin_inset Quotes eld
\end_inset

bad
\begin_inset Quotes erd
\end_inset

 detection function.
 Rows are the models (see Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:Models"

\end_inset

) and columns give the design (see Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:Designs"

\end_inset

).
 Here we see generally good behaviour in all models (some negative bias
 across the board, perhaps more severe for the HT-based methods than Figure
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:biasf"

\end_inset

 would have us believe), though the spatial models are slightly positively
 biased (though more spread out than with the good detectability), which
 is likely down to model overparamatrisation (smooths should be estimated
 with zero effects, which is hard).
 
\begin_inset CommandInset label
LatexCommand label
name "fig:quantile-f-bad"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<plot-results-selfconfidence-lr-bad, fig.width=9, fig.height=9, echo=FALSE,
 message=FALSE, warning=FALSE>>=
\end_layout

\begin_layout Plain Layout

huge_res_lr <- huge_res[huge_res$density=="lr" & huge_res$df=="bad",]
\end_layout

\begin_layout Plain Layout

plot_quantile(huge_res_lr)
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Histograms of the 
\begin_inset Quotes eld
\end_inset

self-confidence
\begin_inset Quotes erd
\end_inset

 measure for each model for the left-right density surface with a 
\begin_inset Quotes eld
\end_inset

bad
\begin_inset Quotes erd
\end_inset

 detection function.
 Rows are the models (see Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:Models"

\end_inset

) and columns give the design (see Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:Designs"

\end_inset

).
 As in Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:biasf"

\end_inset

 we see negative bias in the results, though again this is more extreme
 for the HT-based methods for the 
\begin_inset Quotes eld
\end_inset

zzl
\begin_inset Quotes erd
\end_inset

 design.
 
\begin_inset CommandInset label
LatexCommand label
name "fig:quantile-lr-bad"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<plot-results-selfconfidence-rl-bad, fig.width=9, fig.height=9, echo=FALSE,
 message=FALSE, warning=FALSE>>=
\end_layout

\begin_layout Plain Layout

huge_res_rl <- huge_res[huge_res$density=="rl" & huge_res$df=="bad",]
\end_layout

\begin_layout Plain Layout

plot_quantile(huge_res_rl)
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Histograms of the 
\begin_inset Quotes eld
\end_inset

self-confidence
\begin_inset Quotes erd
\end_inset

 measure for each model for the right-left density surface with a 
\begin_inset Quotes eld
\end_inset

bad
\begin_inset Quotes erd
\end_inset

 detection function.
 Rows are the models (see Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:Models"

\end_inset

) and columns give the design (see Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:Designs"

\end_inset

).
 As in Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:biasf"

\end_inset

 we see negative bias in the results, though again this is more extreme
 for the HT-based stratified method for the 
\begin_inset Quotes eld
\end_inset

zzl
\begin_inset Quotes erd
\end_inset

 design, for the unstratified HT estimate we see positive bias for the 
\begin_inset Quotes eld
\end_inset

zzl
\begin_inset Quotes erd
\end_inset

 design as the model thinks that there is low detectability everywhere and
 hence underestimates detectability, overestimating abundance.
 
\begin_inset CommandInset label
LatexCommand label
name "fig:quantile-rl-bad"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<plot-results-selfconfidence-f-w, fig.width=9, fig.height=9, echo=FALSE,
 message=FALSE, warning=FALSE>>=
\end_layout

\begin_layout Plain Layout

huge_res_f <- huge_res[huge_res$density=="f",]
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

plot_quantile(huge_res_f)
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Histograms of the 
\begin_inset Quotes eld
\end_inset

self-confidence
\begin_inset Quotes erd
\end_inset

 measure for each model for the flat density surface when the weather covariate
 was used to generate data.
 Here we see generally good behaviour in all models, though the spatial
 models are slightly positively biased, which is likely down to model overparama
trisation (smooths should be estimated with zero effects, which is hard).
 Rows are the models (see Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:Models"

\end_inset

) and columns give the design (see Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:Designs"

\end_inset

).
 
\begin_inset CommandInset label
LatexCommand label
name "fig:quantile-f-w"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<plot-results-selfconfidence-lr-w, fig.width=9, fig.height=9, echo=FALSE,
 message=FALSE, warning=FALSE>>=
\end_layout

\begin_layout Plain Layout

huge_res_lr <- huge_res[huge_res$density=="lr",]
\end_layout

\begin_layout Plain Layout

plot_quantile(huge_res_lr, TRUE)
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Histograms of the 
\begin_inset Quotes eld
\end_inset

self-confidence
\begin_inset Quotes erd
\end_inset

 measure for each model for the left-right density surface when the weather
 covariate was used to generate data.
 Rows are the models (see Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:Models"

\end_inset

) and columns give the design (see Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:Designs"

\end_inset

).
 For the 
\begin_inset Quotes eld
\end_inset

zzl
\begin_inset Quotes erd
\end_inset

 design the stratification (which acts as spatial and covariate stratification)
 is quite important, giving much better results (again predicated on the
 correct stratification being selected).
 Spatial model results seem reasonable with the notable exception of the
 Duchon and shrinkage (TPSH) methods for the 
\begin_inset Quotes eld
\end_inset

twozigzag
\begin_inset Quotes erd
\end_inset

 design.
\begin_inset CommandInset label
LatexCommand label
name "fig:quantile-lr-w"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<plot-results-selfconfidence-rl-w, fig.width=9, fig.height=9, echo=FALSE,
 message=FALSE, warning=FALSE>>=
\end_layout

\begin_layout Plain Layout

huge_res_rl <- huge_res[huge_res$density=="rl",]
\end_layout

\begin_layout Plain Layout

plot_quantile(huge_res_rl, TRUE)
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Histograms of the 
\begin_inset Quotes eld
\end_inset

self-confidence
\begin_inset Quotes erd
\end_inset

 measure for each model for the right-left density surface when the weather
 covariate was used to generate data.
 Rows are the models (see Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:Models"

\end_inset

) and columns give the design (see 
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:Designs"

\end_inset

).
 Here the 
\begin_inset Quotes eld
\end_inset

zzl
\begin_inset Quotes erd
\end_inset

 design allocates more effort to the low density areas, since there are
 many detections in the high effort area, the HT estimator overestimates
 abundance, the stratification improves this a little but causes underestimation
, even including the covariate doesn't improve things much.
 We again see more erratic behaviour from the Duchon and shrinkage smoothers
 (TPSH) for the 
\begin_inset Quotes eld
\end_inset

twozigzag
\begin_inset Quotes erd
\end_inset

 design.
 
\begin_inset CommandInset label
LatexCommand label
name "fig:quantile-rl-w"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<plot-results-selfconfidence-diag-w, fig.width=2.5, fig.height=7, echo=FALSE,
 message=FALSE, warning=FALSE>>=
\end_layout

\begin_layout Plain Layout

huge_res_diag <- huge_res[huge_res$density=="diag",]
\end_layout

\begin_layout Plain Layout

plot_quantile(huge_res_diag, TRUE)
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Histograms of the 
\begin_inset Quotes eld
\end_inset

self-confidence
\begin_inset Quotes erd
\end_inset

 measure for each model for the diagonal density surface when the weather
 covariate was used to generate data.
 Rows are the models (see Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:Models"

\end_inset

) and columns give the design (see 
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:Designs"

\end_inset

).
 As in Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:biasdiag"

\end_inset

, the HT-based methods perform poorly, generally overestimating abundance,
 the spatial models (now not suffering from model overparamatrisation) perform
 very well, exhibiting the 
\begin_inset Quotes eld
\end_inset

conservative
\begin_inset Quotes erd
\end_inset

 behaviour referred to in Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:self-confidence"

\end_inset

.
 
\begin_inset CommandInset label
LatexCommand label
name "fig:quantile-diag-w"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard

\lang english
\begin_inset Newpage pagebreak
\end_inset


\begin_inset Note Note
status open

\begin_layout Plain Layout

\lang english
\begin_inset CommandInset bibtex
LatexCommand bibtex
bibfiles "full,this"
options "plainnat"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard

\lang english
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
printbibliography
\end_layout

\end_inset


\end_layout

\end_body
\end_document
